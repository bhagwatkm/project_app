<% if notice %>
  <div class="mb-4 p-3 rounded bg-green-100 text-green-800 border border-green-200">
    <%= notice %>
  </div>
<% end %>

<% content_for :title, "Tasks" %>

<h1 class="text-3xl font-bold mb-6 text-gray-800">Tasks</h1>

<!-- Search and Filter Form -->
<!-- Search and Filter Form -->
<div class="mb-6">
  <%= form_with url: search_organization_project_tasks_path(@organization, @project), method: :post, local: true, class: "flex flex-wrap gap-4 items-end" do %>
    <div>
      <%= label_tag :search, "Search by Title", class: "block text-sm font-medium text-gray-700 mb-1" %>
      <%= text_field_tag :search, params[:search], placeholder: "Enter title...", class: "px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" %>
    </div>
    <div>
      <%= label_tag :status, "Filter by Status", class: "block text-sm font-medium text-gray-700 mb-1" %>
      <%= select_tag :status, options_for_select(Task.statuses.keys.map { |s| [s.humanize, s] }, params[:status]), include_blank: "All", class: "px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" %>
    </div>
    <div>
      <%= submit_tag "Filter", class: "px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 transition" %>
    </div>
    <% if params[:search].present? || params[:status].present? %>
      <div>
        <%= link_to "Clear", organization_project_tasks_path(@organization, @project), class: "px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 transition" %>
      </div>
    <% end %>
  <% end %>
</div>

<div id="tasks">
  <div class="overflow-x-auto">
    <table class="min-w-full bg-white shadow rounded-lg">
      <thead>
        <tr>
          <th class="px-6 py-3 border-b-2 border-gray-200 bg-gray-50 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
            <%= link_to "Title", request.params.merge(sort: "title", direction: params[:direction] == "asc" ? "desc" : "asc"), class: "hover:underline" %>
            <% if params[:sort] == "title" %>
              <%= params[:direction] == "asc" ? "▲" : "▼" %>
            <% end %>
          </th>
          <th class="px-6 py-3 border-b-2 border-gray-200 bg-gray-50 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
            <%= link_to "Status", request.params.merge(sort: "status", direction: params[:direction] == "asc" ? "desc" : "asc"), class: "hover:underline" %>
            <% if params[:sort] == "status" %>
              <%= params[:direction] == "asc" ? "▲" : "▼" %>
            <% end %>
          </th>
          <th class="px-6 py-3 border-b-2 border-gray-200 bg-gray-50 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Actions</th>
        </tr>
      </thead>
      <tbody>
        <% @tasks.each do |task| %>
          <tr class="hover:bg-gray-50">
            <td class="px-6 py-4 border-b border-gray-200"><%= task.title %></td>
            <td class="px-6 py-4 border-b border-gray-200"><%= task.status.humanize %></td>
            <td class="px-6 py-4 border-b border-gray-200">
              <div class="flex gap-2">
                <%= link_to "Show", organization_project_task_path(@organization, @project, task), class: "px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-xs" %>
                <%= link_to "Edit", edit_organization_project_task_path(@organization, @project, task), class: "px-3 py-1 bg-yellow-500 text-white rounded hover:bg-yellow-600 text-xs" %>
                <%= button_to "Delete", organization_project_task_path(@organization, @project, task), method: :delete, data: { confirm: "Are you sure?" }, class: "px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 text-xs" %>
              </div>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>

<div class="flex justify-center my-6">
  <%= will_paginate @tasks, class: 'pagination flex space-x-2' %>
</div>

<%= link_to "New task", new_organization_project_task_path(@organization, @project), class: "inline-block px-6 py-3 bg-green-600 text-white font-semibold rounded shadow hover:bg-green-700 transition" %>